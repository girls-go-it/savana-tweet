{% extends "base.html" %}
{% block content %}
{% block styles%}
  {{super()}}
  <link rel="stylesheet" href="{{url_for('.static', filename='timeline.css')}}">
{% endblock %}
{% set currentDate = '' %}
{% set postCounter = 0 %}
<div class="container">
    <div class="page-header">
      <h1 id="">Savana Timeline</h1>
    </div>
    
  <div id="timeline">
    <form method="POST" action="/create-feed" role="form" class="add_post" enctype="multipart/form-data">
          {{ form.csrf_token }}
          <div class="form-group {% if form.content.errors %}has-error{% endif %} ">
              {{ form.content(class_='form-control',maxlength='140',rows='3',placeholder="Adaugă postare nouă!") }}
              <span class="help-block">{{ ' '.join(form.content.errors) }}</span>
          </div>

          <div class="form-group {% if form.image.errors %}has-error{% endif %} ">
              <label style="display: inline-block;" for="{{form.image.id}}"><span style="font-size: 25px; cursor: pointer;" class="glyphicon glyphicon-picture"></span></label>
              {{ form.image(class_='form-control',style="display: none;") }}
              {{ form.submit(class_='btn btn-sm btn-default', style="margin-left: 5px; margin-top: -15px; display: inline-block;") }}
              <span class="help-block">{{ ' '.join(form.image.errors) }}</span>

          </div>
      </form>
    <div class="row timeline-movement timeline-movement-top">
    <div class="timeline-badge timeline-filter-movement">
        <a href="#">
            <span class="glyphicon glyphicon-time"></span>
        </a>
    </div>
  </div>

  {% for post in posts %}
    {% set postCounter = postCounter + 1 %}
    {% if post.date.fullDate != currentDate %}
      {% if currentDate != '' %}
        </div>
      {% endif %}
      {% set left = 0 %}
      {% set currentDate = post.date.fullDate %}

      <div class="row timeline-movement">
        <div class="timeline-badge">
            <span class="timeline-balloon-date-day">{{ post.date.day }}</span>
            <span class="timeline-balloon-date-month">{{ months[post.date.month] }}</span>
        </div>
      {% endif %}
      {% set left = not left %}
          
          {% if left and postCounter == 1 %}
            <div class="row">
          {% endif %}
          {% if left and postCounter > 1 %}
            </div><div class="row">
          {% endif %}

          <div class="col-sm-6  timeline-item">
              <div class="row">
                  <div class="{% if not left %} {{'col-sm-offset-1 '}} {% endif %}col-sm-11">
                      <div class="timeline-panel {% if left %} {{'left'}} {% else %} {{'right'}} {% endif %}">
                          <ul class="timeline-panel-ul">
                              
                              <li><img class="profile_pic" src="{% if post.animal.image_url %}{{ url_for('static', filename=post.animal.image_url) }}{% else %}{{ url_for('static', filename='download.png') }}{% endif %}" alt="poster image"><span class="importo">{{ post.username }}</span></li>

                              <li><span>{{ post.content }}</span> </li>
                              {% if post.image_url %}
                                <li><img class="post_img" src="{{ url_for('static', filename=post.image_url) }}" alt="poster image"><span class="importo">{{ post.username }}</span></li>
                              {% endif %}
                              
                              <li><p><small class="text-muted"><i class="glyphicon glyphicon-time"></i> {{post.date.time}} </small></p></li>
                              
                              <li>
                                {% if current_user.likes_post(post) %}
                                  <form action="/posts/{{ post.id }}/unlike" method="POST">
                                    <label class="pointer" for="dislike-{{post.id}}">{{ post.likes|length }} <span class="glyphicon glyphicon-heart" aria-hidden="true"></span></label>
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                                    <input id="dislike-{{post.id}}" class="btn btn-link" type="submit" value="Unlike" style="display: none;"/>
                                  </form>
                                {% else %}
                                  <form action="/posts/{{ post.id }}/like" method="POST">
                                  <label class="pointer" for="like-{{post.id}}">{{ post.likes|length }} <span class="glyphicon glyphicon-heart-empty" aria-hidden="true"></span></label>
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                                    <input id="like-{{post.id}}" class="btn btn-link" type="submit" style="display:none;" value="Like" />
                                  </form>
                                {% endif %}
                              </li>
                          </ul>
                      </div>

                  </div>
              </div>
          </div>
    {% endfor %}
</div>

{% endblock %}
